<UserControl x:Class="PaperTrail.App.Views.ContractEditView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:PaperTrail.App.Converters"
             xmlns:models="clr-namespace:PaperTrail.Core.Models;assembly=PaperTrail.Core"
             AllowDrop="True">
    <UserControl.Resources>
        <conv:EnumToItemsSourceConverter x:Key="EnumConv" />
        <conv:DateOnlyToDateTimeConverter x:Key="DateOnlyConv" />
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <!-- Command Bar -->
        <DockPanel Margin="4" LastChildFill="False">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                <Button Content="Save" Command="{Binding SaveCommand}"/>
                <Button Content="Cancel" Command="{Binding CancelCommand}"/>
                <Button Content="Delete" Command="{Binding DeleteCommand}"/>
            </StackPanel>
            <ComboBox Width="120" DockPanel.Dock="Right"
                      ItemsSource="{Binding Source={x:Type models:ContractStatus}, Converter={StaticResource EnumConv}}"
                      SelectedItem="{Binding SelectedStatus}"/>
        </DockPanel>

        <!-- Main Tabs -->
        <TabControl Grid.Row="1">
            <!-- Details Tab -->
            <TabItem Header="Details">
                <StackPanel Margin="10" >
                    <TextBlock Text="Party" />
                    <ComboBox ItemsSource="{Binding Parties}" SelectedItem="{Binding SelectedParty}" IsEditable="True" />
                    <Button Content="Add Party" Command="{Binding AddPartyCommand}" Width="80" />
                    <TextBlock Text="Title" Margin="0,8,0,0" />
                    <TextBox Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock Text="Value" Margin="0,8,0,0" />
                    <TextBox Text="{Binding ValueAmount, StringFormat=C}" />
                    <TextBlock Text="Tags" Margin="0,8,0,0" />
                    <StackPanel Orientation="Horizontal">
                        <TextBox Width="120" Text="{Binding NewTagText}" />
                        <Button Content="Add" Command="{Binding AddTagCommand}"/>
                    </StackPanel>
                    <ItemsControl ItemsSource="{Binding Tags}" Margin="0,4,0,0">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource TagChipStyle}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding}"/>
                                        <Button Content="âœ•"
                                                Command="{Binding DataContext.RemoveTagCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                CommandParameter="{Binding}"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </TabItem>

            <!-- Dates Tab -->
            <TabItem Header="Dates">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <TextBlock Text="Effective" Grid.Row="0"/>
                    <DatePicker SelectedDate="{Binding EffectiveDate, Converter={StaticResource DateOnlyConv}}" Grid.Column="1"/>
                    <TextBlock Text="Renewal" Grid.Row="1"/>
                    <DatePicker SelectedDate="{Binding RenewalDate, Converter={StaticResource DateOnlyConv}}" Grid.Row="1" Grid.Column="1"/>
                    <TextBlock Text="Renewal Term (months)" Grid.Row="2"/>
                    <TextBox Text="{Binding RenewalTermMonths}" Grid.Row="2" Grid.Column="1"/>
                    <TextBlock Text="Notice Period (days)" Grid.Row="3"/>
                    <TextBox Text="{Binding NoticePeriodDays}" Grid.Row="3" Grid.Column="1"/>
                    <TextBlock Text="Termination" Grid.Row="4"/>
                    <DatePicker SelectedDate="{Binding TerminationDate, Converter={StaticResource DateOnlyConv}}" Grid.Row="4" Grid.Column="1"/>
                    <TextBlock Text="Next Renewal" Grid.Row="5"/>
                    <TextBox Text="{Binding ComputedNextRenewal}" Grid.Row="5" Grid.Column="1" IsReadOnly="True"/>
                    <TextBlock Text="Notice Date" Grid.Row="6"/>
                    <TextBox Text="{Binding ComputedNoticeDate}" Grid.Row="6" Grid.Column="1" IsReadOnly="True"/>
                </Grid>
            </TabItem>

            <!-- Attachments Tab -->
            <TabItem Header="Attachments">
                <StackPanel Margin="10">
                    <TextBlock Text="Drag files here to attach" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                    <ListView ItemsSource="{Binding Attachments}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="File" DisplayMemberBinding="{Binding FileName}"/>
                                <GridViewColumn Header="Hash" DisplayMemberBinding="{Binding Hash}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </StackPanel>
            </TabItem>

            <!-- Reminders Tab -->
            <TabItem Header="Reminders">
                <StackPanel Margin="10">
                    <DataGrid ItemsSource="{Binding Reminders}" AutoGenerateColumns="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" />
                            <DataGridTextColumn Header="Due" Binding="{Binding DueUtc}" />
                        </DataGrid.Columns>
                    </DataGrid>
                    <Button Content="Add Reminder" Command="{Binding AddReminderCommand}" Width="120" Margin="0,8,0,0"/>
                </StackPanel>
            </TabItem>

            <!-- Notes Tab -->
            <TabItem Header="Notes">
                <TextBox Text="{Binding Notes}" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>
            </TabItem>
        </TabControl>

        <!-- Error summary -->
        <ItemsControl Grid.Row="2" ItemsSource="{Binding ErrorList}" Margin="4"/>
    </Grid>
</UserControl>
